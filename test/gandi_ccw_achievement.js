/*! For license information please see gandi_ccw_achievement.7757546d.js.LICENSE.txt */
"use strict";(self.webpackChunkscratch_extensions=self.webpackChunkscratch_extensions||[]).push([[4334],{16996:(e,t,n)=>{n.r(t),n.d(t,{default:()=>A});var a=n(80673),i=n.n(a),r=n(29122),o=n.n(r),s=n(83392),c=n.n(s),d=n(111),u=n(1109);function h(e){return h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},h(e)}function l(){l=function(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,a=Object.defineProperty||function(e,t,n){e[t]=n.value},i="function"==typeof Symbol?Symbol:{},r=i.iterator||"@@iterator",o=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,n){return e[t]=n}}function d(e,t,n,i){var r=t&&t.prototype instanceof m?t:m,o=Object.create(r.prototype),s=new O(i||[]);return a(o,"_invoke",{value:_(e,n,s)}),o}function u(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=d;var v={};function m(){}function f(){}function p(){}var A={};c(A,r,(function(){return this}));var E=Object.getPrototypeOf,T=E&&E(E(D([])));T&&T!==t&&n.call(T,r)&&(A=T);var g=p.prototype=m.prototype=Object.create(A);function y(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function I(e,t){function i(a,r,o,s){var c=u(e[a],e,r);if("throw"!==c.type){var d=c.arg,l=d.value;return l&&"object"==h(l)&&n.call(l,"__await")?t.resolve(l.__await).then((function(e){i("next",e,o,s)}),(function(e){i("throw",e,o,s)})):t.resolve(l).then((function(e){d.value=e,o(d)}),(function(e){return i("throw",e,o,s)}))}s(c.arg)}var r;a(this,"_invoke",{value:function(e,n){function a(){return new t((function(t,a){i(e,n,t,a)}))}return r=r?r.then(a,a):a()}})}function _(e,t,n){var a="suspendedStart";return function(i,r){if("executing"===a)throw new Error("Generator is already running");if("completed"===a){if("throw"===i)throw r;return{value:void 0,done:!0}}for(n.method=i,n.arg=r;;){var o=n.delegate;if(o){var s=b(o,n);if(s){if(s===v)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===a)throw a="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);a="executing";var c=u(e,t,n);if("normal"===c.type){if(a=n.done?"completed":"suspendedYield",c.arg===v)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(a="completed",n.method="throw",n.arg=c.arg)}}}function b(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,b(e,t),"throw"===t.method))return v;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return v}var a=u(n,e.iterator,t.arg);if("throw"===a.type)return t.method="throw",t.arg=a.arg,t.delegate=null,v;var i=a.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,v):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,v)}function G(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function L(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function O(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(G,this),this.reset(!0)}function D(e){if(e){var t=e[r];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var a=-1,i=function t(){for(;++a<e.length;)if(n.call(e,a))return t.value=e[a],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}return{next:w}}function w(){return{value:void 0,done:!0}}return f.prototype=p,a(g,"constructor",{value:p,configurable:!0}),a(p,"constructor",{value:f,configurable:!0}),f.displayName=c(p,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===f||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,p):(e.__proto__=p,c(e,s,"GeneratorFunction")),e.prototype=Object.create(g),e},e.awrap=function(e){return{__await:e}},y(I.prototype),c(I.prototype,o,(function(){return this})),e.AsyncIterator=I,e.async=function(t,n,a,i,r){void 0===r&&(r=Promise);var o=new I(d(t,n,a,i),r);return e.isGeneratorFunction(n)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},y(g),c(g,s,"Generator"),c(g,r,(function(){return this})),c(g,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),n=[];for(var a in t)n.push(a);return n.reverse(),function e(){for(;n.length;){var a=n.pop();if(a in t)return e.value=a,e.done=!1,e}return e.done=!0,e}},e.values=D,O.prototype={constructor:O,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(L),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function a(n,a){return o.type="throw",o.arg=e,t.next=n,a&&(t.method="next",t.arg=void 0),!!a}for(var i=this.tryEntries.length-1;i>=0;--i){var r=this.tryEntries[i],o=r.completion;if("root"===r.tryLoc)return a("end");if(r.tryLoc<=this.prev){var s=n.call(r,"catchLoc"),c=n.call(r,"finallyLoc");if(s&&c){if(this.prev<r.catchLoc)return a(r.catchLoc,!0);if(this.prev<r.finallyLoc)return a(r.finallyLoc)}else if(s){if(this.prev<r.catchLoc)return a(r.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<r.finallyLoc)return a(r.finallyLoc)}}}},abrupt:function(e,t){for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var r=i;break}}r&&("break"===e||"continue"===e)&&r.tryLoc<=t&&t<=r.finallyLoc&&(r=null);var o=r?r.completion:{};return o.type=e,o.arg=t,r?(this.method="next",this.next=r.finallyLoc,v):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),v},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),L(n),v}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var a=n.completion;if("throw"===a.type){var i=a.arg;L(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:D(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),v}},e}function v(e,t,n,a,i,r,o){try{var s=e[r](o),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(a,i)}function m(e){return function(){var t=this,n=arguments;return new Promise((function(a,i){var r=e.apply(t,n);function o(e){v(r,a,i,o,s,"next",e)}function s(e){v(r,a,i,o,s,"throw",e)}o(void 0)}))}}function f(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function p(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const A=function(){function e(t){var n,a,i=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),p(this,"reloadBoardList",m(l().mark((function e(){var t,n;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,null===(t=i.apis)||void 0===t?void 0:t.getLeaderboardList();case 2:(n=e.sent).length>0?i.boardMenu=n:i.boardMenu=[{text:i.formatMessage("GandiAchievement.menu.noData"),value:""}];case 4:case"end":return e.stop()}}),e)})))),p(this,"reloadAchievementList",m(l().mark((function e(){var t,n;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,null===(t=i.apis)||void 0===t?void 0:t.getAchieveList();case 2:(n=e.sent).length>0?i.achievementMenu=n:i.achievementMenu=[{text:i.formatMessage("GandiAchievement.menu.noData"),value:""}];case 4:case"end":return e.stop()}}),e)})))),p(this,"handleReloadMenu",function(){var e=m(l().mark((function e(t){var n,a;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,i.$reloadBtnTextTag=t.svgGroup_.querySelector(".blocklyText"),n=3,a=i.formatMessage("GandiAchievement.reloading"),i.intervalId=setInterval((function(){i.$reloadBtnTextTag.textContent="".concat(a).concat(".".repeat(++n%4))}),300),e.next=7,i.reloadAchievementList();case 7:return e.next=9,i.reloadBoardList();case 9:clearInterval(i.intervalId),i.$reloadBtnTextTag.textContent=i.formatMessage("GandiAchievement.reloadingFinish"),setTimeout((function(){i.$reloadBtnTextTag.textContent=i.formatMessage("GandiAchievement.reloadList")}),2e3),e.next=21;break;case 14:e.prev=14,e.t0=e.catch(0),console.warn("reload achievement list error",e.t0),clearInterval(i.intervalId),i.$reloadBtnTextTag.textContent=i.formatMessage("GandiAchievement.reloadingFail"),i.achievementMenu=[{text:i.formatMessage("GandiAchievement.menu.noData"),value:""}],i.boardMenu=[{text:i.formatMessage("GandiAchievement.menu.noData"),value:""}];case 21:case"end":return e.stop()}}),e,null,[[0,14]])})));return function(t){return e.apply(this,arguments)}}()),p(this,"SET_THROTTLE_TIME",3e3),p(this,"GET_THROTTLE_TIME",0),p(this,"SET_THROTTLE_OPTIONS",{leading:!1,trailing:!0}),p(this,"GET_THROTTLE_OPTIONS",{leading:!0,trailing:!1}),p(this,"apiInsertLeaderboard",(0,d.Z)(this.callInsertLeaderboard,this.SET_THROTTLE_TIME,this.SET_THROTTLE_OPTIONS)),p(this,"apiUpdateAchievementExtra",(0,d.Z)(this.batchUpdateAchievementExtra,this.SET_THROTTLE_TIME,this.SET_THROTTLE_OPTIONS)),p(this,"apiShowLeaderboard",(0,d.Z)((function(e){var t,n;return(null===(t=i.apis)||void 0===t?void 0:t.showLeaderboard)&&(null===(n=i.apis)||void 0===n?void 0:n.showLeaderboard(e))}),this.GET_THROTTLE_TIME,this.GET_THROTTLE_OPTIONS)),p(this,"apiGetUserInfoFromLeaderboard",(0,d.Z)((function(e,t){var n,a;return(null===(n=i.apis)||void 0===n?void 0:n.getUserInfoFromLeaderboard)&&(null===(a=i.apis)||void 0===a?void 0:a.getUserInfoFromLeaderboard(e,t))}),this.GET_THROTTLE_TIME,this.GET_THROTTLE_OPTIONS)),p(this,"apiGetUserRankingInLeaderboard",(0,d.Z)((function(e){var t,n;return(null===(t=i.apis)||void 0===t?void 0:t.getUserRankingInLeaderboard)&&(null===(n=i.apis)||void 0===n?void 0:n.getUserRankingInLeaderboard(e))}),this.GET_THROTTLE_TIME,this.GET_THROTTLE_OPTIONS)),p(this,"apiShowAchievementList",(0,d.Z)((function(){var e,t;return(null===(e=i.apis)||void 0===e?void 0:e.showAchievementList)&&(null===(t=i.apis)||void 0===t?void 0:t.showAchievementList())}),this.GET_THROTTLE_TIME,this.GET_THROTTLE_OPTIONS)),p(this,"apiHasAchievement",(0,d.Z)((function(e){var t,n;return(null===(t=i.apis)||void 0===t?void 0:t.hasAchievement)&&(null===(n=i.apis)||void 0===n?void 0:n.hasAchievement(e))}),this.GET_THROTTLE_TIME,this.GET_THROTTLE_OPTIONS)),p(this,"apiHasAchievementByTemplateId",(0,d.Z)((function(e){var t,n;return(null===(t=i.apis)||void 0===t?void 0:t.hasAchievementByTemplateId)&&(null===(n=i.apis)||void 0===n?void 0:n.hasAchievementByTemplateId(e))}),this.GET_THROTTLE_TIME,this.GET_THROTTLE_OPTIONS)),this.runtime=t,this.extId="GandiAchievementAndLeaderboard";var r=(null===(n=t.ccwAPI)||void 0===n?void 0:n.getOnlineExtensionsConfig)&&(null===(a=t.ccwAPI)||void 0===a?void 0:a.getOnlineExtensionsConfig()),o=r&&r[this.extId];this.apis=null==o?void 0:o.api,this.runtime.on("CCWAPI_CHANGED",(function(){var e,n,a=(null===(e=t.ccwAPI)||void 0===e?void 0:e.getOnlineExtensionsConfig)&&(null===(n=t.ccwAPI)||void 0===n?void 0:n.getOnlineExtensionsConfig()),r=a&&a[i.extId];i.apis=null==r?void 0:r.api})),this.runtime.on("GANDI_EVENT_CLOSE_LEADERBOARD",(function(){i.runtime.setPaused(!1),i.runtime.startHats("".concat(i.extId,"_whenUIClose"),{UI_TYPE:"leaderboard"})})),this.runtime.on("GANDI_EVENT_CLOSE_ACHIEVEMENT",(function(){i.runtime.setPaused(!1),i.runtime.startHats("".concat(i.extId,"_whenUIClose"),{UI_TYPE:"achievement"})})),this.runtime.on("GANDI_EVENT_LEARDERBOARD_EDITED",(function(){i.reloadBoardList()})),this.writeCache={},this.readCache={},this.jobQueue={},this.formatMessage=t.getFormatMessage({"zh-cn":{"GandiAchievement.categoryName":"æˆå°±ä¸ŽæŽ’è¡Œ","GandiAchievement.showList":"æ˜¾ç¤ºæˆå°±åˆ—è¡¨å¹¶[PAUSE]","GandiAchievement.obtain":"èŽ·å–æˆå°±[ACHIEVE_ID]å¹¶[TOAST]","GandiAchievement.has":"æ‹¥æœ‰æˆå°±[ACHIEVE_ID]?","GandiAchievement.hasGlobal":"æ‹¥æœ‰æˆå°±[ACHIEVE_ID]?","GandiAchievement.setUserDesc":"è®¾ç½®æˆå°±[ACHIEVE_ID]é¢å¤–æè¿°[CUSTOM_DESC]","GandiAchievement.whenClose":"å½“ [UI_TYPE] å…³é—­","GandiAchievement.reloadList":"åˆ·æ–°èœå•åˆ—è¡¨","GandiAchievement.reloading":"åˆ·æ–°ä¸­...","GandiAchievement.reloadingFail":"âŒ å¤±è´¥ï¼Œè¯·é‡è¯•","GandiAchievement.reloadingFinish":"âœ… å®Œæˆ ","GandiAchievement.updateAchievementExtra":"æ›´æ–°æˆå°±[ACHIEVE_ID]çš„é¢å¤–æè¿°[EXT]","GandiAchievement.section":"ðŸŽ– æˆå°±ç§¯æœ¨ ","GandiLeaderboard.section":"ðŸ† æŽ’è¡Œæ¦œç§¯æœ¨ ","GandiLeaderboard.showList":"æ˜¾ç¤ºæŽ’è¡Œæ¦œ[BOARD_ID]å¹¶[PAUSE]","GandiLeaderboard.addScore":"å°†[SCORE]åŠ å…¥åˆ°[BOARD_ID]å¹¶é™„å¸¦[LOG]","GandiLeaderboard.getBoardData":"çŽ©å®¶åœ¨[BOARD_ID]çš„[BOARD_DATA]","GandiLeaderboard.getUserDataByRanking":"åœ¨[BOARD_ID]ç¬¬[RANKING]åçš„[USER_DATA]","GandiAchievement.toast":"æç¤º","GandiAchievement.notToast":"ä¸æç¤º","GandiAchievement.pause":"æš‚åœ","GandiAchievement.notPause":"ä¸æš‚åœ","GandiAchievement.type.achievement":"æˆå°±åˆ—è¡¨","GandiAchievement.type.leaderboard":"æŽ’è¡Œæ¦œ","GandiAchievement.type.username":"ç”¨æˆ·å","GandiAchievement.type.userId":"ç”¨æˆ·ID","GandiAchievement.type.score":"åˆ†æ•°","GandiAchievement.type.ranking":"æŽ’å","GandiAchievement.type.log":"æ—¥å¿—","GandiAchievement.menu.noData":"æ²¡æœ‰æ•°æ®ï¼Œè¯·å°è¯•ä½¿ç”¨åˆ·æ–°æŒ‰é’® "},en:{"GandiAchievement.categoryName":"Achievement and Leaderboard","GandiAchievement.showList":"open achievement list and[PAUSE]","GandiAchievement.obtain":"obtain achievement[ACHIEVE_ID] with [TOAST]","GandiAchievement.has":"has achievement[ACHIEVE_ID]?","GandiAchievement.hasGlobal":"has achievement[ACHIEVE_ID]?","GandiAchievement.setUserDesc":"set description[CUSTOM_DESC] to achievement[ACHIEVE_ID]","GandiAchievement.whenClose":"when [UI_TYPE] close","GandiAchievement.reloadList":"reload menu list","GandiAchievement.reloading":"reloading...","GandiAchievement.reloadingFail":"âŒ failed, please try again","GandiAchievement.reloadingFinish":"âœ… done","GandiAchievement.updateAchievementExtra":"update achievement [ACHIEVE_ID] with extra [EXT]","GandiAchievement.section":"ðŸŽ– Achievement Block ","GandiLeaderboard.section":"ðŸ† Leaderboard Block ","GandiLeaderboard.showList":"show leaderboard[BOARD_ID]and[PAUSE]","GandiLeaderboard.addScore":"add score[SCORE]to[BOARD_ID]with[LOG]","GandiLeaderboard.getBoardData":"user's [BOARD_DATA] in[BOARD_ID]","GandiLeaderboard.getUserDataByRanking":"user's[USER_DATA]in[BOARD_ID]at ranking[RANKING]","GandiAchievement.toast":"popup","GandiAchievement.notToast":"nothing","GandiAchievement.pause":"pause","GandiAchievement.notPause":"don't pause","GandiAchievement.type.achievement":"Achievement","GandiAchievement.type.leaderboard":"Leaderboard","GandiAchievement.type.username":"username","GandiAchievement.type.userId":"user ID","GandiAchievement.type.score":"score","GandiAchievement.type.ranking":"ranking","GandiAchievement.type.log":"log","GandiAchievement.menu.noData":"no data, please try reload button"}}),this.achievementMenu=[{text:this.formatMessage("GandiAchievement.reloading"),value:""}],this.boardMenu=[{text:this.formatMessage("GandiAchievement.type.reloading"),value:""}],this.reloadAchievementList(),this.reloadBoardList()}var t,n,a;return t=e,a=[{key:"STATE_KEY",get:function(){return"Gandi.Achievement"}}],(n=[{key:"getInfo",value:function(){var e={opcode:"showAchievementList",blockType:o().COMMAND,text:this.formatMessage({id:"GandiAchievement.showList",default:"Open Achievement List and [PAUSE]"}),arguments:{PAUSE:{type:i().NUMBER,defaultValue:0,menu:"PAUSE_MENU"}}},t={opcode:"obtainAchievement",blockType:o().COMMAND,text:this.formatMessage({id:"GandiAchievement.obtain",default:"obtain achievement [ACHIEVE_ID]"}),arguments:{ACHIEVE_ID:{type:i().STRING,defaultValue:"",menu:"ACHIEVE_MENU"},TOAST:{type:i().STRING,defaultValue:"",menu:"TOAST_MENU"}}},n={opcode:"updateAchievementExtra",blockType:o().COMMAND,text:this.formatMessage({id:"GandiAchievement.updateAchievementExtra",default:"update achievement [ACHIEVE_ID] with extra [EXT]?"}),arguments:{ACHIEVE_ID:{type:i().STRING,defaultValue:"",menu:"ACHIEVE_MENU"},EXT:{type:i().STRING,defaultValue:"love from scratcher"}}},a={opcode:"hasAchievement",blockType:o().BOOLEAN,text:this.formatMessage({id:"GandiAchievement.has",default:"has achievement [ACHIEVE_ID]?"}),arguments:{ACHIEVE_ID:{type:i().STRING,defaultValue:"",menu:"ACHIEVE_MENU"}}},r={opcode:"hasAchievementByTemplateId",blockType:o().BOOLEAN,text:this.formatMessage({id:"GandiAchievement.has",default:"has achievement[ACHIEVE_ID]?"}),arguments:{ACHIEVE_ID:{type:i().STRING,defaultValue:"id"}}},s={opcode:"whenUIClose",blockType:o().EVENT,isEdgeActivated:!1,text:this.formatMessage({id:"GandiAchievement.whenClose",default:"when [UI_TYPE] close"}),arguments:{UI_TYPE:{type:i().STRING,defaultValue:"leaderboard",menu:"UI_TYPE_MENU"}}},c={opcode:"showLeaderboard",blockType:o().COMMAND,text:this.formatMessage({id:"GandiLeaderboard.showList",default:"show leaderboard[BOARD_ID]and[PAUSE]"}),arguments:{BOARD_ID:{type:i().STRING,defaultValue:"",menu:"BOARD_MENU"},PAUSE:{type:i().STRING,defaultValue:"0",menu:"PAUSE_MENU"}}},d={opcode:"addUserScoreToLeaderboard",blockType:o().COMMAND,text:this.formatMessage({id:"GandiLeaderboard.addScore",default:"add score[SCORE]to[BOARD_ID]with[LOG]"}),arguments:{BOARD_ID:{type:i().STRING,defaultValue:"",menu:"BOARD_MENU"},SCORE:{type:i().NUMBER,defaultValue:0},LOG:{type:i().STRING,defaultValue:this.formatMessage("GandiAchievement.type.log")}}},h={opcode:"getUserDataFromLeaderboard",blockType:o().REPORTER,text:this.formatMessage({id:"GandiLeaderboard.getUserDataByRanking",default:"user's[USER_DATA]in[BOARD_ID]at ranking[RANKING]"}),arguments:{USER_DATA:{type:i().STRING,defaultValue:"userId",menu:"USER_DATA_TYPE_MENU"},BOARD_ID:{type:i().STRING,defaultValue:"",menu:"BOARD_MENU"},RANKING:{type:i().NUMBER,defaultValue:1}}},l={opcode:"getUserBoardDataFromLeaderboardByUserId",blockType:o().REPORTER,text:this.formatMessage({id:"GandiLeaderboard.getBoardData",default:"user's [BOARD_DATA] in[BOARD_ID]"}),arguments:{BOARD_ID:{type:i().STRING,defaultValue:"",menu:"BOARD_MENU"},BOARD_DATA:{type:i().STRING,defaultValue:"ranking",menu:"BOARD_DATA_TYPE_MENU"}}},v={blockType:o().BUTTON,text:this.formatMessage("GandiAchievement.reloadList"),onClick:this.handleReloadMenu};return{id:this.extId,name:this.formatMessage("GandiAchievement.categoryName"),color1:"#3597f8",menuIconURI:u.Z,blockIconURI:u.Z,blocks:[s,v,"--- ".concat(this.formatMessage("GandiAchievement.section")),e,t,a,r,n,"--- ".concat(this.formatMessage("GandiLeaderboard.section")),c,d,h,l],menus:{ACHIEVE_MENU:{items:"buildAchievementMenu",acceptReporters:!0},BOARD_MENU:"buildBoardMenu",TOAST_MENU:[{text:this.formatMessage("GandiAchievement.toast"),value:"1"},{text:this.formatMessage("GandiAchievement.notToast"),value:"0"}],PAUSE_MENU:[{text:this.formatMessage("GandiAchievement.pause"),value:"1"},{text:this.formatMessage("GandiAchievement.notPause"),value:"0"}],UI_TYPE_MENU:[{text:this.formatMessage("GandiAchievement.type.leaderboard"),value:"leaderboard"},{text:this.formatMessage("GandiAchievement.type.achievement"),value:"achievement"}],USER_DATA_TYPE_MENU:[{text:this.formatMessage("GandiAchievement.type.userId"),value:"userId"},{text:this.formatMessage("GandiAchievement.type.username"),value:"username"},{text:this.formatMessage("GandiAchievement.type.score"),value:"score"}],BOARD_DATA_TYPE_MENU:[{text:this.formatMessage("GandiAchievement.type.score"),value:"score"},{text:this.formatMessage("GandiAchievement.type.ranking"),value:"ranking"}]}}}},{key:"buildAchievementMenu",value:function(){return this.achievementMenu}},{key:"buildBoardMenu",value:function(){return this.boardMenu}},{key:"callInsertLeaderboard",value:function(e){var t,n=this,a=e.BOARD_ID,i=e.SCORE,r=e.LOG,o=this.compatibleOldLeaderboardId(a),s="addScore".concat(o),c=this.writeCache[s];if(c&&i===c.score)return console.warn("çŸ­æ—¶é—´ï¼ˆ15sï¼‰å†…å°è¯•å†™å…¥ç›¸åŒçš„æŽ’è¡Œæ¦œåˆ†æ•°, è¯·æ£€æŸ¥ä½ çš„ä»£ç  - æ•°æ®:åˆ†æ•°=".concat(i)),void console.warn("write the same leaderboard score in a short time (15s), please check your code - data:score=".concat(i));var d,u=Number.isNaN(Number(i))?0:Number(i);null!==(t=this.apis)&&void 0!==t&&t.insertLeaderboard&&(null===(d=this.apis)||void 0===d||d.insertLeaderboard(o,u,r).then((function(e){e&&(n.writeCache[s]={id:o,score:i},setTimeout((function(){delete n.writeCache[s]}),15e3))})))}},{key:"doUpdateAchievementExtra",value:function(e){var t,n,a=this,i=e.ACHIEVE_ID,r=e.EXT,o="updateExtra".concat(i),s=this.writeCache[o];if(s&&r===s.ext)return console.warn("å°è¯•å¯¹åŒä¸€æˆå°±å†™å…¥ç›¸åŒçš„æè¿°, è¯·æ£€æŸ¥ä½ çš„ä»£ç  - æ•°æ®: id=".concat(i," æè¿°=").concat(r)),void console.warn("write the same extra text to same achievement id, please check your code - data:id=".concat(i," text=").concat(r));null!==(t=this.apis)&&void 0!==t&&t.updateAchievementExtra&&(null===(n=this.apis)||void 0===n||n.updateAchievementExtra(i,r).then((function(e){e&&(a.writeCache[o]={id:i,ext:r})})))}},{key:"batchUpdateAchievementExtra",value:function(){var e=this;this.jobQueue&&this.jobQueue.updateAchievementExtra&&(Object.values(this.jobQueue.updateAchievementExtra).forEach((function(t){return e.doUpdateAchievementExtra(t)})),delete this.jobQueue.updateAchievementExtra)}},{key:"showAchievementList",value:function(e){var t=this,n=e.PAUSE;c().toBoolean(n)&&setTimeout((function(){t.runtime.setPaused(c().toBoolean(n))}),100),this.apiShowAchievementList()}},{key:"obtainAchievement",value:function(e){var t,n;e.ACHIEVE_ID&&e.ACHIEVE_ID.length>0&&null!==(t=this.apis)&&void 0!==t&&t.obtainAchievement&&(null===(n=this.apis)||void 0===n||n.obtainAchievement(e.ACHIEVE_ID,c().toBoolean(e.TOAST)))}},{key:"updateAchievementExtra",value:function(e){var t=e.ACHIEVE_ID;e.EXT,this.jobQueue.updateAchievementExtra||(this.jobQueue.updateAchievementExtra={}),this.jobQueue.updateAchievementExtra[t]=e,this.apiUpdateAchievementExtra()}},{key:"hasAchievement",value:function(e){var t=this,n=c().toString(e.ACHIEVE_ID);if(n.length>0){var a="a_".concat(n);return this.readCache[a]?this.readCache[a]:this.apiHasAchievement(n).then((function(e){return t.readCache[a]=e,e}))}return!1}},{key:"hasAchievementByTemplateId",value:function(e){var t=this,n=c().toString(e.ACHIEVE_ID);if(n.length>0){var a="a_".concat(n);return this.readCache[a]?this.readCache[a]:this.apiHasAchievementByTemplateId(n).then((function(e){return t.readCache[a]=e,e}))}return!1}},{key:"whenUIClose",value:function(){return!0}},{key:"compatibleOldLeaderboardId",value:function(e){var t=e;return"leaderboard"===t&&(t=this.boardMenu[0].value),t||this.runtime.logSystem.warn("Leaderboard not found"),t}},{key:"showLeaderboard",value:function(e){var t=this,n=e.BOARD_ID,a=e.PAUSE,i=this.compatibleOldLeaderboardId(n);this.apiShowLeaderboard(i),c().toBoolean(a)&&setTimeout((function(){t.runtime.setPaused(c().toBoolean(a))}),100)}},{key:"addUserScoreToLeaderboard",value:function(e){this.apiInsertLeaderboard(e)}},{key:"getUserDataFromLeaderboard",value:function(e){var t=e.BOARD_ID,n=e.USER_DATA,a=e.RANKING,i=this.compatibleOldLeaderboardId(t);return this.apiGetUserInfoFromLeaderboard(i,a).then((function(e){switch(n){case"userId":return e.userId;case"username":return e.username;case"score":return e.score;default:return null}}))}},{key:"getUserBoardDataFromLeaderboardByUserId",value:function(e){var t=e.BOARD_ID,n=e.BOARD_DATA,a=this.compatibleOldLeaderboardId(t);return this.apiGetUserRankingInLeaderboard(a).then((function(e){switch(n){case"score":return e.score;case"ranking":return e.ranking;default:return null}}))}}])&&f(t.prototype,n),a&&f(t,a),Object.defineProperty(t,"prototype",{writable:!1}),e}()},111:(e,t,n)=>{n.d(t,{Z:()=>r});var a=n(98956),i=n(77226);const r=function(e,t,n){var r=!0,o=!0;if("function"!=typeof e)throw new TypeError("Expected a function");return(0,i.Z)(n)&&(r="leading"in n?!!n.leading:r,o="trailing"in n?!!n.trailing:o),(0,a.Z)(e,t,{leading:r,maxWait:t,trailing:o})}}}]);